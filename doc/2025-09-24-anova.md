## Variance of Treatment Effect on the Treated
In a potential outcome model,
$$
Y_{it} = (1-D_{it})Y_{it}(0) + D_{it}Y_{it}(1).
$$
The treatment effect is $Y_{it}(1) - Y_{it}(0)$. A typical object of interest is the average treatment effect on the treated (ATET),
$$
\text E(Y_{it}(1) - Y_{it}(0)|D_{it}=1).
$$
Here we care about the variance of the treatment effect, because we want to do a variance decomposition: how much of the variance in $Y_{it}$ does the treatment explain?
$$
\text E[Y_{it}^2] = 
\text E[Y_{it0}^2] +
\text E[D_{it}(Y_{it1}-Y_{it0})^2] +
2\text E[Y_{it0}D_{it}(Y_{it1}-Y_{it0})]
$$
$$
 = 
\text E[Y_{it0}^2] +
\text E[(Y_{it1}-Y_{it0})^2|D_{it}=1]\Pr(D_{it}=1) +
2\text E[Y_{it0}(Y_{it1}-Y_{it0})|D_{it}]\Pr(D_{it}=1)
$$

> We may need to assume the treatment effect is orthogonal to the level of the outcome, conditional on treatment status.

The object of interest is the variance decomposition
$$
\text{Var}(Y_{it1}|D_{it}=1) =
\text{Var}(Y_{it0}|D_{it}=1) + \text{Var}(Y_{it1}-Y_{it0}|D_{it}=1) +
\text{Cov}(Y_{it0},Y_{it1}-Y_{it0}|D_{it}=1).
$$
The variance of outcome for the treated is the sum of the counterfactual variance, plus the variance of the treatment effect, plus the covariance of the treatment effect with the counterfactual outcome.

> Not sure why we want to condition on treated units. We may want to compute this unconditionally.

The term on the LHS can be computed from the data. The first term on the RHS, counterfactual variance, can be estimated in usual ways as an ATET for $Y_{it}^2$ (which may need additional parallel trends assumptions for $Y^2$). So the remaining terms, 

> the "additional variance from treatment" can be written as the difference between two ATETs: one for squared outcome and one for level outcome (squared)

$$
\text{Var}(Y_{it1}|D_{it}=1) -
\text{Var}(Y_{it0}|D_{it}=1) = 
$$
$$
\text{E}(Y_{it1}^2|D_{it}=1) -
\text{E}(Y_{it0}^2|D_{it}=1) - 
\left[\text{E}(Y_{it1}|D_{it}=1)^2  - \text{E}(Y_{it0}|D_{it}=1)^2\right]
$$
To write the squared term as an ATET,
$$
\text{E}(Y_{it1}|D_{it}=1)^2-\text{E}(Y_{it0}|D_{it}=1)^2 = 
$$
$$
\text{E}(Y_{it1}|D_{it}=1)^2 -[\text{E}(Y_{it0}|D_{it}=1)-\text{E}(Y_{it1}|D_{it}=1)+\text{E}(Y_{it1}|D_{it}=1)]^2 =
$$
$$
 -[\text{E}(Y_{it1}|D_{it}=1)-\text{E}(Y_{it0}|D_{it}=1)]^2+
2[\text{E}(Y_{it1}|D_{it}=1)-\text{E}(Y_{it0}|D_{it}=1)]\text{E}(Y_{it1}|D_{it}=1)
$$
Let $\gamma_1 = \text{E}(Y_{it1}|D_{it}=1)-\text{E}(Y_{it0}|D_{it}=1)$ the first-order ATET, and $\gamma_2 = \text{E}(Y_{it1}^2|D_{it}=1)-\text{E}(Y_{it0}^2|D_{it}=1)$ the second-order ATET.

Then the "additional variance from the treatment" is
$$
\text{Var}(Y_{it1}|D_{it}=1) -
\text{Var}(Y_{it0}|D_{it}=1) =
\gamma_2 + \gamma_1^2 -2\gamma_1\text{E}(Y_{it1}|D_{it}=1)
$$
> Note that this may be negative if managers are counteracting shocks.

## Variance of growth rates relative to $g$
$$
\text{Var}(Y_{it1}-Y_{ig1}|D_{it}=1) -
\text{Var}(Y_{it0}-Y_{ig0}|D_{it}=1) =
\gamma_{2,gt} + \gamma_{1,gt}^2 -2\gamma_{1,gt}\text{E}(Y_{it1}-Y_{ig1}|D_{it}=1)
$$

### With two-period diff-in-diff
$$
\text{Var}(\Delta Y_{it1}|D_{it}=1) -
\text{Var}(\Delta Y_{it0}|D_{it}=1) =
\gamma_{2} - \gamma_{1}^2 -2\gamma_{1}\text{E}(\Delta Y_{it0}|D_{it}=0)
$$
$$
\text{Var}(\Delta Y_{it1}|D_{it}=1) -
\text{Var}(\Delta Y_{it0}|D_{it}=1) =
\gamma_{2} + \gamma_{1}^2 -2\gamma_{1}\text{E}(\Delta Y_{it1}|D_{it}=1)
$$
$$
\frac{\text{Var}(\Delta Y_{it1}|D_{it}=1) -
\text{Var}(\Delta Y_{it0}|D_{it}=1)}{\text{Var}(\Delta Y_{it1}|D_{it}=1)} =
\frac{\gamma_{2} + \gamma_{1}^2 -2\gamma_{1}\text{E}(\Delta Y_{it1}|D_{it}=1)}{\text{Var}(\Delta Y_{it1}|D_{it}=1)}
$$


$$
\text{Var}(\Delta Y_{it1}|D_{it}=1) -
\text{Var}(\Delta Y_{it0}|D_{it}=1) =
\gamma_{2}  -\gamma_{1}[\text{E}(\Delta Y_{it0}|D_{it}=0)+\text{E}(\Delta Y_{it1}|D_{it}=1)]
$$


## Unconditional variance
The object of interest is the variance decomposition
$$
\text{Var}(Y_{it1}|D_{it}=1) =
\text{Var}(Y_{it0}|D_{it}=1) + \text{Var}(Y_{it1}-Y_{it0}|D_{it}=1) +
\text{Cov}(Y_{it0},Y_{it1}-Y_{it0}|D_{it}=1).
$$

$$
\text{Var}(Y_{it}) = \text E(Y_{it}^2) - \text E(Y_{it})^2
$$
$$
\text E(Y_{it}^2) = \text E(Y_{it0}^2|D_{it}=0)\Pr(D_{it}=0) +
\text E(Y_{it1}^2|D_{it}=1)\Pr(D_{it}=1)
$$
$$
\text E(Y_{it})^2 = [\text E(Y_{it0}|D_{it}=0)\Pr(D_{it}=0) +
\text E(Y_{it1}|D_{it}=1)\Pr(D_{it}=1)]^2 =
$$
$$
...
$$

## Event studies
Let $\gamma_e$ define the ATT for event time $e$,
$$
\gamma_e = \text E(\Delta_0 Y_{it1} - \Delta_0 Y_{it0}|D_{i,t-e}=1)
$$
where $\Delta_0$ is relative to some baseline year (birth).

> Since we already take out a level with $\Delta_0$ _and_ we do exact matching on firm age, we do _not_ have to include firm fixed effects when estimating parallel trends for the control group. A simple mean comparison by event time is sufficient.

We treat $\gamma_e = 0$ for $e<0$. 

> Should we correct for pretrends if there are any?

We can write
$$
\text{Var}(\Delta_0 Y_{it1}|D_i=1) = \text{E}((\Delta_0 Y_{it1})^2|D_i=1) -
\text{E}(\Delta_0 Y_{it1}|D_i=1)^2.
$$
This can be measured in the data by averaging $\Delta_0 Y$ and it square for all treated firms. Because we thing variance grows with firm age, we compute this separate for each firm age,
$$
\text{Var}_a(Y_{it1}-Y_{i,t-a,1}|D_i=1) = \text{E}_a((Y_{it1}-Y_{i,t-a,1})^2|D_i=1) -
\text{E}_a(Y_{it1}-Y_{i,t-a,1}|D_i=1)^2.
$$
We are interested in the counterfactual variance, the variance that would have prevailed had this firm not been treated at time $g$.
$$
\text{Var}_a(Y_{it0}-Y_{i,t-a,0}|D_i=1) = \text{E}_a((Y_{it0}-Y_{i,t-a,0})^2|D_i=1) -
\text{E}_a(Y_{it0}-Y_{i,t-a,0}|D_i=1)^2.
$$
As usual, the problem is that we don't observe the counterfactual path $Y_{it0}$ for treated firms. We will use the parallel trends assumption to estimate it.

Subtract the ATET from the treated firms' outcome to get
$$
\hat Y_{it0} = \Delta_0 Y_{it1} - \hat\gamma_{t-g}.
$$
This is not the same as $\Delta_0 Y_{it0}$, because higher moments like variance will also change with the treatment. But this variable has the same mean as $\Delta_0Y_{it0}$, while having the same variance as $\Delta_0Y_{it1}$. (The variance does not depend on removing a constant.)

> In practice, there is an estimation error in $\hat\gamma_{t-g}$, which would add to the variance. But given our large sample, we can ignore this error.

We can write the "additional variance of the treated" (AVT) as
$$
\eta_{ga} :=\text{Var}_a(\Delta_0 Y_{it1}|D_{ig}=1) - \text{Var}_a(\Delta_0 Y_{it0}|D_{ig}=1) =
\text{Var}_a(\hat Y_{it0}|D_{ig}=1) - \text{Var}_a(\Delta_0 Y_{it0}|D_{ig}=1) =
$$
$$
\text{E}_a(\hat Y_{it0}^2|D_{ig}=1) - \text{E}_a((\Delta_0 Y_{it0})^2|D_{ig}=1).
$$
The first equation follows from variance being invariant to subtraction of constant, the second from the fact that the means of the two variables are equal.

The last term is unobserved, but can be estimated with an _additional assumption_ that parallel trends also holds for second moments of $\Delta Y$,
$$
\text{E}_a((\Delta_0 Y_{it0})^2|D_{ig}=1) = \text{E}_a((\Delta_0 Y_{it0})^2|D_{ig}=0).
$$
That is $\eta_{ga}$ is the ATET between treated and placebo groups, when estimated on $\hat Y_{it0}^2$ and $(\Delta_0 Y_{it0})^2$.

> This ATET estimation _should_ include a firm fixed effect. Unless we assume that the _level_ of variance is the same.

> Note that $\gamma_{t-g}$ is only constant conditional on $g$ and $t$.

To obtain $\eta_a$, we need to average across $g$s.

If we want to estimate event studies, we can allow $\eta$ to vary with $t$ and estimate $\eta_{gat}$, and average over $e=t-g$. 

## Proper cumulation
Under the model, we can write
$$
\Delta_0 \omega_{it} = \sum_{a=1}^{t-b}\Delta\omega_{i,b+a} = 
\sum_{a=1}^{t-b}\Delta\epsilon_{i,b+a}
$$
for control firms, and
$$
\Delta_0 \omega_{it} = \sum_{a=1}^{t-b}\Delta\omega_{i,b+a} = 
z_{mit} - z_{mi0}+\sum_{a=1}^{t-b}\Delta\epsilon_{i,b+a}
$$
for firms that have changed their CEO in the period.

The change in TFP between the birth of the firm and period $t$ is the cumulated TFP growth rate.

### A simple numerical example
Suppose $\Delta z$ is orthogonal to $\Delta \epsilon$ and the latter is iid over time. That is, TFP has a unit root. Then
$$
\text{Var}(\Delta_0 \omega_{it}|D_{it}=0) = (t-b)\text{Var}(\Delta\epsilon|D_{it}=0) = (t-b)\sigma^2_0
$$
and
$$
\text{Var}(\Delta_0 \omega_{it}|D_{it}=1) = \text{Var}(\Delta z)+(t-b)\text{Var}(\Delta\epsilon|D_{it}=1) = \text{Var}(\Delta z)+(t-b)\sigma^2_1
$$
The object of interest is the first term: the contribution of manager change to long-run growth variance. 

Note, however, that the variance of residual productivity growth may be different between treated and control firms.

### Precise solution
Let
$$
\text{Var}(\Delta_0 \epsilon_{it}|D_{it}=0,t=b_i+a) = \sigma^2_{a0}
$$
be the age-specific variance of residual TFP for control firms and 
$$
\text{Var}(\Delta_0 \epsilon_{it}|D_{it}=0,D_i=1,t=b_i+a) = \sigma^2_{a1}
$$
the same for not-yet treated firms. This allows for age-specific shocks that are arbitrarily correlated over time and may arbitrarily differ between treated and control firms.

> Parallel trends in second moments: we assume that, for all $t$, the variance of the error term only depends on firm age and whether the firm is treated, but not the time of treatment.

$$
\text{Var}(\Delta_0 \epsilon_{it}|D_i=1,t=b_i+a) = \text{Var}(\Delta_0 \epsilon_{it}|D_{it}=0,D_i=1,t=b_i+a)
$$
 
Then we can write 
$$
\text{Var}(\Delta_0 \omega_{it}|D_{i}=0,t=b_i+a) = \sigma^2_{a0}
$$
and 
$$
\text{Var}(\Delta_0 \omega_{it}|D_i=1,t=b_i+a) = \sigma^2_{a1} + \text{Var}(z_{m}-z_{m'})
$$

Note, however, that $\hat z_m$ includes average error terms, so its change will be correlated with $\Delta\epsilon$. 

When we estimate the counterfactual variance of a treated firm (what would have been its variance without treatment), we use the placebo control group, but correct for age-specific pretrends, $\sigma^2_{a1} - \sigma^2_{a0}$. Other than this correction, this is a standard diff-in-diff for second moments instead of means.